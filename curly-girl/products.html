<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Guide | Curly Girl Wavy Girl UK</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">
        <span class="nav-logo-icon">&#127754;</span>
        CurlMagic UK
      </a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">&#10024; Home</a></li>
        <li><a href="checker.html">&#128270; Scanner</a></li>
        <li><a href="products.html" class="active">&#128218; Products</a></li>
        <li><a href="quiz.html">&#9889; Quiz</a></li>
        <li><a href="faq.html">&#128172; FAQ</a></li>
      </ul>
      <button class="nav-toggle" onclick="toggleNav()" aria-label="Toggle menu">&#9776;</button>
    </div>
  </nav>

  <main class="container" style="padding-top:2rem; padding-bottom:3rem;">
    <section class="hero" style="padding-bottom:1rem;">
      <h1 style="font-size:clamp(2rem, 5vw, 3rem);">Product <span class="highlight">Guide</span></h1>
      <p>257 CGM-reviewed products from Poundland to premium. Filter by category, hair type, budget, and more.</p>
    </section>

    <section style="padding-top:0;">
      <div class="products-toolbar">
        <input type="text" class="products-search" id="productSearch" placeholder="Search products, brands, or retailers..." oninput="filterProducts()">
      </div>

      <div class="filter-row">
        <select class="filter-select" id="filterCategory" onchange="filterProducts()"><option value="">All Categories</option></select>
        <select class="filter-select" id="filterRetailer" onchange="filterProducts()"><option value="">All Retailers</option></select>
        <select class="filter-select" id="filterCGM" onchange="filterProducts()"><option value="">CGM Status</option><option value="approved">Approved</option><option value="caution">Caution</option><option value="not_approved">Not Approved</option></select>
        <select class="filter-select" id="filterWeight" onchange="filterProducts()"><option value="">All Weights</option><option value="lightweight">Lightweight</option><option value="medium">Medium</option><option value="heavy">Heavy</option></select>
        <select class="filter-select" id="filterTag" onchange="filterProducts()"><option value="">All Tags</option></select>
        <select class="filter-select" id="filterSort" onchange="filterProducts()"><option value="price-asc">Price: Low to High</option><option value="price-desc">Price: High to Low</option><option value="name">Name A-Z</option><option value="brand">Brand A-Z</option></select>
      </div>

      <div class="filter-chips" id="filterChips"></div>
      <div class="results-summary" id="resultsSummary"></div>
      <div class="product-grid" id="productGrid"></div>
      <div class="load-more" id="loadMore" style="display:none;">
        <button class="btn btn-secondary btn-sm" onclick="showMore()" style="border-radius:2rem;">Show More</button>
      </div>
      <div class="warnings-section" id="warningsSection"></div>
    </section>
  </main>

  <footer class="footer">
    <p>Built by <a href="../index.html">Stackless</a> &copy; 2026</p>
    <p class="disclaimer">Product information is community-sourced and may change. Always check the current ingredient list on the packaging.</p>
  </footer>

  <script src="products-data.js"></script>
  <script src="app.js"></script>
  <script>
    var BATCH_SIZE = 40;
    var currentResults = [];
    var displayedCount = 0;

    function init() { populateFilters(); renderWarnings(); filterProducts(); }

    function populateFilters() {
      var products = window.CG_PRODUCTS || [];
      var cats = [...new Set(products.map(function(p) { return p.category; }))].sort();
      var catSelect = document.getElementById('filterCategory');
      cats.forEach(function(c) { var opt = document.createElement('option'); opt.value = c; opt.textContent = formatLabel(c); catSelect.appendChild(opt); });
      var retailers = [...new Set(products.map(function(p) { return p.retailer.split(' / ')[0].trim(); }))].sort();
      var retSelect = document.getElementById('filterRetailer');
      retailers.forEach(function(r) { var opt = document.createElement('option'); opt.value = r; opt.textContent = r; retSelect.appendChild(opt); });
      var tags = [...new Set(products.flatMap(function(p) { return p.tags; }))].filter(Boolean).sort();
      var tagSelect = document.getElementById('filterTag');
      tags.forEach(function(t) { var opt = document.createElement('option'); opt.value = t; opt.textContent = formatLabel(t); tagSelect.appendChild(opt); });
    }

    function formatLabel(s) { return s.replace(/[-_]/g, ' ').replace(/\b\w/g, function(c) { return c.toUpperCase(); }); }
    function parsePrice(priceStr) { if (!priceStr) return 999; var match = priceStr.match(/[\d.]+/); return match ? parseFloat(match[0]) : 999; }

    function filterProducts() {
      var products = window.CG_PRODUCTS || [];
      var search = document.getElementById('productSearch').value.toLowerCase().trim();
      var category = document.getElementById('filterCategory').value;
      var retailer = document.getElementById('filterRetailer').value;
      var cgm = document.getElementById('filterCGM').value;
      var weight = document.getElementById('filterWeight').value;
      var tag = document.getElementById('filterTag').value;
      var sort = document.getElementById('filterSort').value;
      var filtered = products.filter(function(p) {
        if (search) { var haystack = (p.name + ' ' + p.brand + ' ' + p.retailer + ' ' + p.notes + ' ' + p.tags.join(' ')).toLowerCase(); if (haystack.indexOf(search) === -1) return false; }
        if (category && p.category !== category) return false;
        if (retailer && p.retailer.indexOf(retailer) === -1) return false;
        if (cgm && p.cgm !== cgm) return false;
        if (weight && p.weight !== weight) return false;
        if (tag && p.tags.indexOf(tag) === -1) return false;
        return true;
      });
      filtered.sort(function(a, b) {
        if (sort === 'price-asc') return parsePrice(a.price) - parsePrice(b.price);
        if (sort === 'price-desc') return parsePrice(b.price) - parsePrice(a.price);
        if (sort === 'name') return a.name.localeCompare(b.name);
        if (sort === 'brand') return a.brand.localeCompare(b.brand) || a.name.localeCompare(b.name);
        return 0;
      });
      currentResults = filtered; displayedCount = 0;
      document.getElementById('productGrid').innerHTML = '';
      showMore(); updateSummary(); updateChips();
    }

    function showMore() {
      var grid = document.getElementById('productGrid');
      var end = Math.min(displayedCount + BATCH_SIZE, currentResults.length);
      for (var i = displayedCount; i < end; i++) grid.appendChild(createProductCard(currentResults[i]));
      displayedCount = end;
      document.getElementById('loadMore').style.display = displayedCount < currentResults.length ? 'block' : 'none';
    }

    function createProductCard(p) {
      var card = document.createElement('div'); card.className = 'product-card';
      var tagsHTML = p.tags.map(function(t) { return '<span class="product-tag tag-' + t + '">' + formatLabel(t) + '</span>'; }).join('');
      card.innerHTML = '<div class="product-header"><span class="product-name">' + escapeHtml(p.name) + '</span><span class="product-price">' + escapeHtml(p.price) + '</span></div><div class="product-meta"><span class="product-meta-item meta-brand">' + escapeHtml(p.brand) + '</span><span class="product-meta-item meta-retailer">' + escapeHtml(p.retailer) + '</span><span class="product-meta-item meta-category">' + formatLabel(p.category) + '</span><span class="product-meta-item meta-weight-' + p.weight + '">' + formatLabel(p.weight) + '</span><span class="product-cgm cgm-' + p.cgm + '">' + formatLabel(p.cgm.replace('_', ' ')) + '</span></div>' + (tagsHTML ? '<div class="product-tags">' + tagsHTML + '</div>' : '') + (p.notes ? '<div class="product-notes">' + escapeHtml(p.notes) + '</div>' : '');
      return card;
    }

    function escapeHtml(str) { var div = document.createElement('div'); div.textContent = str; return div.innerHTML; }

    function updateSummary() {
      var total = (window.CG_PRODUCTS || []).length; var shown = currentResults.length;
      document.getElementById('resultsSummary').textContent = shown === total ? 'Showing all ' + total + ' products' : 'Showing ' + shown + ' of ' + total + ' products';
    }

    function updateChips() {
      var chips = document.getElementById('filterChips'); chips.innerHTML = '';
      [{ id: 'filterCategory', label: 'Category' }, { id: 'filterRetailer', label: 'Retailer' }, { id: 'filterCGM', label: 'CGM' }, { id: 'filterWeight', label: 'Weight' }, { id: 'filterTag', label: 'Tag' }].forEach(function(f) {
        var val = document.getElementById(f.id).value;
        if (val) { var chip = document.createElement('span'); chip.className = 'filter-chip'; chip.innerHTML = f.label + ': ' + formatLabel(val) + ' <span class="chip-x">x</span>'; chip.onclick = function() { document.getElementById(f.id).value = ''; filterProducts(); }; chips.appendChild(chip); }
      });
      var search = document.getElementById('productSearch').value.trim();
      if (search) { var chip = document.createElement('span'); chip.className = 'filter-chip'; chip.innerHTML = 'Search: "' + escapeHtml(search) + '" <span class="chip-x">x</span>'; chip.onclick = function() { document.getElementById('productSearch').value = ''; filterProducts(); }; chips.appendChild(chip); }
    }

    function renderWarnings() {
      var warnings = window.CG_WARNINGS || []; if (!warnings.length) return;
      var section = document.getElementById('warningsSection');
      var html = '<h3>Reformulated or Discontinued Products</h3>';
      warnings.forEach(function(w) { html += '<div class="warning-item"><strong>' + escapeHtml(w.product) + '</strong>: ' + escapeHtml(w.note) + '</div>'; });
      section.innerHTML = html;
    }

    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
  </script>
</body>
</html>
