<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Guide | Curly Girl Wavy Girl UK</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
    <script>(function(){var t=localStorage.getItem('stackless-theme')||'light';document.documentElement.setAttribute('data-theme',t);})();</script>
</head>
<body>
  <a href="#main" class="skip-to-main">Skip to main content</a>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">
        <span class="nav-logo-icon">&#127754;</span>
        CurlMagic UK
      </a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">&#10024; Home</a></li>
        <li><a href="checker.html">&#128270; Scanner</a></li>
        <li><a href="products.html" class="active">&#128218; Products</a></li>
        <li><a href="quiz.html">&#9889; Quiz</a></li>
        <li><a href="faq.html">&#128172; FAQ</a></li>
        <li><a href="listen.html">&#127911; Listen</a></li>
      </ul>
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode"><span class="icon-sun"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><line x1="12" y1="2" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="6.34" y2="6.34"/><line x1="17.66" y1="17.66" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="6.34" y2="17.66"/><line x1="17.66" y1="6.34" x2="19.07" y2="4.93"/></svg></span><span class="icon-moon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span></button>
      <button class="nav-toggle" onclick="toggleNav()" aria-label="Toggle menu">&#9776;</button>
    </div>
  </nav>

  <main id="main" class="container" style="padding-top:2rem; padding-bottom:3rem;">
    <section class="hero" style="padding-bottom:1rem;">
      <h1 style="font-size:clamp(2rem, 5vw, 3rem);">Product <span class="highlight">Guide</span></h1>
      <p>330+ UK haircare products: CG-approved picks from Poundland to premium, plus common non-CG products with explanations. Filter by category, hair type, budget, and more.</p>
    </section>

    <section style="padding-top:0;">
      <div class="products-toolbar">
        <input type="text" class="products-search" id="productSearch" placeholder="Search products, brands, or retailers..." oninput="filterProducts()">
      </div>

      <div class="filter-row">
        <select class="filter-select" id="filterCategory" onchange="filterProducts()"><option value="">All Categories</option></select>
        <select class="filter-select" id="filterRetailer" onchange="filterProducts()"><option value="">All Retailers</option></select>
        <select class="filter-select" id="filterCGM" onchange="filterProducts()"><option value="">CGM Status</option><option value="approved">Approved</option><option value="caution">Caution</option><option value="not_approved">Not Approved</option></select>
        <select class="filter-select" id="filterWeight" onchange="filterProducts()"><option value="">All Weights</option><option value="lightweight">Lightweight</option><option value="medium">Medium</option><option value="heavy">Heavy</option></select>
        <select class="filter-select" id="filterTag" onchange="filterProducts()"><option value="">All Tags</option></select>
        <select class="filter-select" id="filterSort" onchange="filterProducts()"><option value="price-asc">Price: Low to High</option><option value="price-desc">Price: High to Low</option><option value="name">Name A-Z</option><option value="brand">Brand A-Z</option></select>
      </div>

      <div class="filter-chips" id="filterChips">
        <button class="btn btn-secondary btn-sm clear-all-filters" id="clearAllFilters" style="display:none; border-radius:2rem; font-size:0.8rem; padding:0.35rem 1rem;" onclick="clearAllFilters()">Clear all filters</button>
      </div>
      <div class="results-summary" id="resultsSummary" aria-live="polite"></div>
      <div class="product-grid" id="productGrid"></div>
      <div class="no-results" id="noResults" style="display:none; text-align:center; padding:2rem 1rem;">
        <div style="font-size:2rem; margin-bottom:0.75rem;">&#128566;</div>
        <h3 style="margin-bottom:0.5rem;">No products match your filters</h3>
        <p class="text-muted" style="font-size:0.9rem;">Try removing some filters or searching for something different.</p>
      </div>
      <div class="load-more" id="loadMore" style="display:none;">
        <button class="btn btn-secondary btn-sm" id="loadMoreBtn" onclick="showMore()" style="border-radius:2rem;">Show More</button>
      </div>
      <div class="warnings-section" id="warningsSection"></div>
    </section>
  </main>

  <footer class="footer">
    <p>Built by <a href="../index.html">Stackless</a> &copy; 2026</p>
    <p class="disclaimer">Product information is community-sourced and may change. Always check the current ingredient list on the packaging.</p>
  </footer>

  <script src="products-data.js"></script>
  <script src="app.js"></script>
  <script>
    var BATCH_SIZE = 40;
    var currentResults = [];
    var displayedCount = 0;

    function init() { populateFilters(); renderWarnings(); filterProducts(); }

    function populateFilters() {
      var products = window.CG_PRODUCTS || [];
      var cats = [...new Set(products.map(function(p) { return p.category; }))].sort();
      var catSelect = document.getElementById('filterCategory');
      cats.forEach(function(c) { var opt = document.createElement('option'); opt.value = c; opt.textContent = formatLabel(c); catSelect.appendChild(opt); });
      var retailers = [...new Set(products.map(function(p) { return p.retailer.split(' / ')[0].trim(); }))].sort();
      var retSelect = document.getElementById('filterRetailer');
      retailers.forEach(function(r) { var opt = document.createElement('option'); opt.value = r; opt.textContent = r; retSelect.appendChild(opt); });
      var tags = [...new Set(products.flatMap(function(p) { return p.tags; }))].filter(Boolean).sort();
      var tagSelect = document.getElementById('filterTag');
      var tagDefs = window.CG_PRODUCT_TAGS || {};
      tags.forEach(function(t) { var opt = document.createElement('option'); opt.value = t; opt.textContent = tagDefs[t] ? tagDefs[t].label : formatLabel(t); tagSelect.appendChild(opt); });
    }

    function formatLabel(s) { return s.replace(/[-_]/g, ' ').replace(/\b\w/g, function(c) { return c.toUpperCase(); }); }
    function parsePrice(priceStr) { if (!priceStr) return 999; var match = priceStr.match(/[\d.]+/); return match ? parseFloat(match[0]) : 999; }

    function clearAllFilters() {
      document.getElementById('productSearch').value = '';
      document.getElementById('filterCategory').value = '';
      document.getElementById('filterRetailer').value = '';
      document.getElementById('filterCGM').value = '';
      document.getElementById('filterWeight').value = '';
      document.getElementById('filterTag').value = '';
      document.getElementById('filterSort').value = 'price-asc';
      filterProducts();
    }

    function filterProducts() {
      var products = window.CG_PRODUCTS || [];
      var search = document.getElementById('productSearch').value.toLowerCase().trim();
      var category = document.getElementById('filterCategory').value;
      var retailer = document.getElementById('filterRetailer').value;
      var cgm = document.getElementById('filterCGM').value;
      var weight = document.getElementById('filterWeight').value;
      var tag = document.getElementById('filterTag').value;
      var sort = document.getElementById('filterSort').value;
      var filtered = products.filter(function(p) {
        if (search) { var haystack = (p.name + ' ' + p.brand + ' ' + p.retailer + ' ' + p.notes + ' ' + p.tags.join(' ')).toLowerCase(); if (haystack.indexOf(search) === -1) return false; }
        if (category && p.category !== category) return false;
        if (retailer && p.retailer.indexOf(retailer) === -1) return false;
        if (cgm && p.cgm !== cgm) return false;
        if (weight && p.weight !== weight) return false;
        if (tag && p.tags.indexOf(tag) === -1) return false;
        return true;
      });
      filtered.sort(function(a, b) {
        if (sort === 'price-asc') return parsePrice(a.price) - parsePrice(b.price);
        if (sort === 'price-desc') return parsePrice(b.price) - parsePrice(a.price);
        if (sort === 'name') return a.name.localeCompare(b.name);
        if (sort === 'brand') return a.brand.localeCompare(b.brand) || a.name.localeCompare(b.name);
        return 0;
      });
      currentResults = filtered; displayedCount = 0;
      document.getElementById('productGrid').innerHTML = '';
      document.getElementById('noResults').style.display = filtered.length === 0 ? 'block' : 'none';
      if (filtered.length > 0) showMore();
      updateSummary(); updateChips();
    }

    function showMore() {
      var grid = document.getElementById('productGrid');
      var btn = document.getElementById('loadMoreBtn');
      if (btn) { btn.textContent = 'Loading...'; btn.disabled = true; }
      setTimeout(function() {
        var end = Math.min(displayedCount + BATCH_SIZE, currentResults.length);
        for (var i = displayedCount; i < end; i++) grid.appendChild(createProductCard(currentResults[i]));
        displayedCount = end;
        document.getElementById('loadMore').style.display = displayedCount < currentResults.length ? 'block' : 'none';
        if (btn) { btn.textContent = 'Show More'; btn.disabled = false; }
      }, 0);
    }

    function createProductCard(p) {
      var card = document.createElement('div'); card.className = 'product-card';
      var tagDefs = window.CG_PRODUCT_TAGS || {};
      var tagsHTML = p.tags.map(function(t) { var label = tagDefs[t] ? tagDefs[t].label : formatLabel(t); return '<span class="product-tag tag-' + t + '">' + label + '</span>'; }).join('');
      card.innerHTML = '<div class="product-header"><span class="product-name">' + escapeHtml(p.name) + '</span><span class="product-price">' + escapeHtml(p.price) + '</span></div>' +
        '<div class="product-meta-text">' + escapeHtml(p.brand) + ' · ' + escapeHtml(p.retailer) + ' · ' + formatLabel(p.category) + '</div>' +
        '<div class="product-badges"><span class="product-meta-item meta-weight-' + p.weight + '">' + formatLabel(p.weight) + '</span><span class="product-cgm cgm-' + p.cgm + '">' + formatLabel(p.cgm.replace('_', ' ')) + '</span></div>' +
        (tagsHTML ? '<div class="product-tags">' + tagsHTML + '</div>' : '') +
        (p.notes ? '<div class="product-notes">' + escapeHtml(p.notes) + '</div>' : '');
      return card;
    }

    function escapeHtml(str) { var div = document.createElement('div'); div.textContent = str; return div.innerHTML; }

    function updateSummary() {
      var total = (window.CG_PRODUCTS || []).length; var shown = currentResults.length;
      document.getElementById('resultsSummary').textContent = shown === total ? 'Showing all ' + total + ' products' : 'Showing ' + shown + ' of ' + total + ' products';
    }

    function updateChips() {
      var chips = document.getElementById('filterChips');
      var clearBtn = document.getElementById('clearAllFilters');
      // Remove all chips but keep the clear button
      var existingChips = chips.querySelectorAll('.filter-chip');
      for (var i = 0; i < existingChips.length; i++) existingChips[i].remove();
      var hasActiveFilters = false;
      [{ id: 'filterCategory', label: 'Category' }, { id: 'filterRetailer', label: 'Retailer' }, { id: 'filterCGM', label: 'CGM' }, { id: 'filterWeight', label: 'Weight' }, { id: 'filterTag', label: 'Tag' }].forEach(function(f) {
        var val = document.getElementById(f.id).value;
        if (val) { hasActiveFilters = true; var chip = document.createElement('span'); chip.className = 'filter-chip'; chip.innerHTML = f.label + ': ' + formatLabel(val) + ' <span class="chip-x">x</span>'; chip.onclick = function() { document.getElementById(f.id).value = ''; filterProducts(); }; chips.appendChild(chip); }
      });
      var search = document.getElementById('productSearch').value.trim();
      if (search) { hasActiveFilters = true; var chip = document.createElement('span'); chip.className = 'filter-chip'; chip.innerHTML = 'Search: "' + escapeHtml(search) + '" <span class="chip-x">x</span>'; chip.onclick = function() { document.getElementById('productSearch').value = ''; filterProducts(); }; chips.appendChild(chip); }
      if (clearBtn) clearBtn.style.display = hasActiveFilters ? 'inline-block' : 'none';
    }

    function renderWarnings() {
      var warnings = window.CG_WARNINGS || []; if (!warnings.length) return;
      var section = document.getElementById('warningsSection');
      var html = '<h3>Reformulated or Discontinued Products</h3>';
      warnings.forEach(function(w) { html += '<div class="warning-item"><strong>' + escapeHtml(w.product) + '</strong>: ' + escapeHtml(w.note) + '</div>'; });
      section.innerHTML = html;
    }

    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
  </script>
</body>
</html>
